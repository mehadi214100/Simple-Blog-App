{% extends "base.html" %}

{% block content %}
    <!-- Main Content -->
    <div class="container mx-auto px-4 py-8">
        <!-- Page Header -->
        <div class="mb-8">
            <h1 class="text-3xl font-bold text-gray-800 mb-2">{% if cat %}Edit Categories {% else %}Add New Category {% endif %} </h1>
            <p class="text-gray-600">Organize your blog posts with categories to help readers find relevant content.</p>
        </div>

        <div class="max-w-4xl mx-auto">
            <!-- Category Form -->
            <div class="bg-white rounded-xl shadow-md p-6 mb-8">
                <form method="POST" action="{% if cat %}{% url 'edit_category' cat.id %}{% else %}{% url 'add_category' %}{% endif %}">
                    {% csrf_token %}
                    <div class="mb-6">
                        <label for="category-name" class="block text-gray-700 font-medium mb-2">
                            Category Name <span class="text-red-500">*</span>
                        </label>
                        <input type="text" id="category-name" 
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition"
                               placeholder="Enter category name (e.g., Technology, Lifestyle, Health)"
                               name="category_name"
                               value="{{ cat.category_name|default:'' }}"
                               required>
                    </div>

                    <div class="mb-6">
                        <label for="category-description" class="block text-gray-700 font-medium mb-2">Description</label>
                        <textarea id="category-description" rows="3" 
                                  class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition"
                                  placeholder="Describe this category..." name="description">{{ cat.description|default:'' }} </textarea>
                    </div>

                    <div class="mb-8">
                        <label class="block text-gray-700 font-medium mb-4">Category Color</label>
                        <input type="hidden" name="color" id="selected-color-input" value="{{ cat.color|default:'blue' }}">
                        <div class="grid grid-cols-5 md:grid-cols-10 gap-4" id="color-container">
                            <div class="color-option bg-green-500 {% if cat.color == 'green' %} ring-4 ring-offset-2 ring-green-400  {% endif %}" onclick="selectColor(this,'green')"></div>
                            <div class="color-option bg-blue-500 {% if cat.color == 'blue' %} ring-4 ring-offset-2 ring-blue-400 {% endif %}" onclick="selectColor(this,'blue')"></div>
                            <div class="color-option bg-red-500 {% if cat.color == 'red' %} ring-4 ring-offset-2 ring-red-40 {% endif %}" onclick="selectColor(this,'red')"></div>
                            <div class="color-option bg-purple-500 {% if cat.color == 'purple' %} ring-4 ring-offset-2 ring-purple-400 {% endif %}" onclick="selectColor(this,'purple')"></div>
                            <div class="color-option bg-yellow-500 {% if cat.color == 'yellow' %} ring-4 ring-offset-2 ring-yellow-400 {% endif %}" onclick="selectColor(this,'yellow')"></div>
                            <div class="color-option bg-indigo-500 {% if cat.color == 'indigo' %}ring-4 ring-offset-2 ring-indigo-400  {% endif %}" onclick="selectColor(this,'indigo')"></div>
                            <div class="color-option bg-pink-500 {% if cat.color == 'pink' %} ring-4 ring-offset-2 ring-pink-400 {% endif %}" onclick="selectColor(this,'pink')"></div>
                            <div class="color-option bg-teal-500 {% if cat.color == 'teal' %} ring-4 ring-offset-2 ring-teal-400 {% endif %}" onclick="selectColor(this,'teal')"></div>
                            <div class="color-option bg-orange-500 {% if cat.color == 'orange' %} ring-4 ring-offset-2 ring-orange-400 {% endif %}" onclick="selectColor(this,'orange')"></div>
                            <div class="color-option bg-gray-500 {% if cat.color == 'gray' %} ring-4 ring-offset-2 ring-gray-400 {% endif %}" onclick="selectColor(this,'gray')"></div>
                        </div>
                        <p class="text-gray-500 text-sm mt-3">Select a color for this category. This will be used for category badges and visual identification.</p>
                    </div>

                    <div class="mb-6">
    <label for="category-icon" class="block text-gray-700 font-medium mb-2">Category Icon</label>
    
    {% with current_icon=cat.icon|default:"" %}
    
    <div class="grid grid-cols-4 md:grid-cols-8 gap-3 mb-4" id="icon-container">
        
        <label class="icon-option flex flex-col items-center p-3 border rounded-lg cursor-pointer hover:bg-gray-50 transition
               {% if current_icon == 'fa-laptop-code' %}bg-blue-50 border-blue-500 ring-2 ring-blue-200{% else %}border-gray-300{% endif %}" 
               onclick="selectIcon(this)">
            <input type="radio" name="icon" class="hidden" value="fa-laptop-code" {% if current_icon == 'fa-laptop-code' %}checked{% endif %}>
            <i class="fas fa-laptop-code text-blue-500 text-2xl mb-2"></i>
            <span class="text-xs text-gray-700">Technology</span>
        </label>

        <label class="icon-option flex flex-col items-center p-3 border rounded-lg cursor-pointer hover:bg-gray-50 transition
               {% if current_icon == 'fa-heart' %}bg-blue-50 border-blue-500 ring-2 ring-blue-200{% else %}border-gray-300{% endif %}" 
               onclick="selectIcon(this)">
            <input type="radio" name="icon" class="hidden" value="fa-heart" {% if current_icon == 'fa-heart' %}checked{% endif %}>
            <i class="fas fa-heart text-red-500 text-2xl mb-2"></i>
            <span class="text-xs text-gray-700">Lifestyle</span>
        </label>

        <label class="icon-option flex flex-col items-center p-3 border rounded-lg cursor-pointer hover:bg-gray-50 transition
               {% if current_icon == 'fa-heartbeat' %}bg-blue-50 border-blue-500 ring-2 ring-blue-200{% else %}border-gray-300{% endif %}" 
               onclick="selectIcon(this)">
            <input type="radio" name="icon" class="hidden" value="fa-heartbeat" {% if current_icon == 'fa-heartbeat' %}checked{% endif %}>
            <i class="fas fa-heartbeat text-green-500 text-2xl mb-2"></i>
            <span class="text-xs text-gray-700">Health</span>
        </label>

        <label class="icon-option flex flex-col items-center p-3 border rounded-lg cursor-pointer hover:bg-gray-50 transition
               {% if current_icon == 'fa-briefcase' %}bg-blue-50 border-blue-500 ring-2 ring-blue-200{% else %}border-gray-300{% endif %}" 
               onclick="selectIcon(this)">
            <input type="radio" name="icon" class="hidden" value="fa-briefcase" {% if current_icon == 'fa-briefcase' %}checked{% endif %}>
            <i class="fas fa-briefcase text-yellow-500 text-2xl mb-2"></i>
            <span class="text-xs text-gray-700">Business</span>
        </label>

        <label class="icon-option flex flex-col items-center p-3 border rounded-lg cursor-pointer hover:bg-gray-50 transition
               {% if current_icon == 'fa-paint-brush' %}bg-blue-50 border-blue-500 ring-2 ring-blue-200{% else %}border-gray-300{% endif %}" 
               onclick="selectIcon(this)">
            <input type="radio" name="icon" class="hidden" value="fa-paint-brush" {% if current_icon == 'fa-paint-brush' %}checked{% endif %}>
            <i class="fas fa-paint-brush text-purple-500 text-2xl mb-2"></i>
            <span class="text-xs text-gray-700">Design</span>
        </label>

        <label class="icon-option flex flex-col items-center p-3 border rounded-lg cursor-pointer hover:bg-gray-50 transition
               {% if current_icon == 'fa-plane' %}bg-blue-50 border-blue-500 ring-2 ring-blue-200{% else %}border-gray-300{% endif %}" 
               onclick="selectIcon(this)">
            <input type="radio" name="icon" class="hidden" value="fa-plane" {% if current_icon == 'fa-plane' %}checked{% endif %}>
            <i class="fas fa-plane text-teal-500 text-2xl mb-2"></i>
            <span class="text-xs text-gray-700">Travel</span>
        </label>

        <label class="icon-option flex flex-col items-center p-3 border rounded-lg cursor-pointer hover:bg-gray-50 transition
               {% if current_icon == 'fa-utensils' %}bg-blue-50 border-blue-500 ring-2 ring-blue-200{% else %}border-gray-300{% endif %}" 
               onclick="selectIcon(this)">
            <input type="radio" name="icon" class="hidden" value="fa-utensils" {% if current_icon == 'fa-utensils' %}checked{% endif %}>
            <i class="fas fa-utensils text-orange-500 text-2xl mb-2"></i>
            <span class="text-xs text-gray-700">Food</span>
        </label>

        <label class="icon-option flex flex-col items-center p-3 border rounded-lg cursor-pointer hover:bg-gray-50 transition
               {% if current_icon == 'fa-graduation-cap' %}bg-blue-50 border-blue-500 ring-2 ring-blue-200{% else %}border-gray-300{% endif %}" 
               onclick="selectIcon(this)">
            <input type="radio" name="icon" class="hidden" value="fa-graduation-cap" {% if current_icon == 'fa-graduation-cap' %}checked{% endif %}>
            <i class="fas fa-graduation-cap text-indigo-500 text-2xl mb-2"></i>
            <span class="text-xs text-gray-700">Education</span>
        </label>

    </div>
    {% endwith %}
</div>

                    <div class="flex justify-end space-x-4">

                        <button type="submit" class="px-6 py-3 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 transition flex items-center">
                            <i class="fas fa-folder-plus mr-2"></i> {% if cat %}Edit {% else %} Add{% endif %} Category
                        </button>
                    </div>
                </form>
            </div>

            <!-- Existing Categories -->
            <div class="bg-white rounded-xl shadow-md p-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-800">Existing Categories</h2>
                    <div class="text-gray-500">
                        <span class="font-medium">{{total}}</span> Categories
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    {% for category in  categories %}
                    <div class="category-badge bg-white border border-gray-200 rounded-xl p-5 hover:shadow-md transition">
                        <div class="flex items-start justify-between mb-4">
                            <div class="flex items-center">
                                <div class="w-12 h-12 rounded-lg bg-{{category.color}}-100 flex items-center justify-center mr-4">
                                    <i class="fas {{category.icon}} text-{{category.color}}-600 text-xl"></i>
                                </div>
                                <div>
                                    <h3 class="font-bold text-gray-800 text-lg">{{category.category_name}}</h3>
                                    <p class="text-gray-500 text-sm">12 Posts</p>
                                </div>
                            </div>
                            
                        </div>
                        <p class="text-gray-600 mb-4 text-justify">{{category.description | truncatewords:"20"}}</p>
                        <div class="flex justify-between items-center">
                            <div class="flex space-x-2">
                                <a href="{% url "edit_category" category.id %}" class="text-blue-600 hover:text-blue-800 text-sm font-medium">Edit</a>
                                <a  href="{% url "delete_category" category.id %}" class="text-red-600 hover:text-red-800 text-sm font-medium">Delete</a>
                            </div>
                            <div class="w-6 h-6 rounded-full bg-{{category.color}}-500"></div>
                        </div>
                    </div>
                    {% endfor %}

                </div>
            </div>
        </div>
    </div>

    <script>

        function selectColor(element,color){
                const allColor = document.querySelectorAll('.color-option');

                allColor.forEach(div =>{

                    div.classList.remove('ring-4', 'ring-offset-2', `ring-${color}-400`);
                    div.style.transform = "scale(1)";

                    element.classList.add('ring-4', 'ring-offset-2', `ring-${color}-400`);
                    element.style.transform = "scale(1.1)";
                    document.getElementById('selected-color-input').value = color;

                    

                });

        }

        function selectIcon(labelElement){
            allIcons = document.querySelectorAll('.icon-option');

            allIcons.forEach(label=>{
                label.classList.remove('bg-blue-50', 'border-blue-500', 'ring-2', 'ring-blue-200');
                label.classList.add('border-gray-300');

                labelElement.classList.remove('border-gray-300');
                labelElement.classList.add('bg-blue-50', 'border-blue-500', 'ring-2', 'ring-blue-200');

                const radioInput = labelElement.querySelector('input[type="radio"]');
                radioInput.checked = true;

            })
        }

    </script>

{% endblock content %}